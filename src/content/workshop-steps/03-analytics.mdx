---
title: "Analytics"
description: "Firebolt MCP integration and performance"
duration: "60 minutes"
difficulty: "intermediate"
objectives:
  - "Run prebuilt queries"
  - "Add customer growth query"
  - "Discuss optimization"
---

import { CodeBlock } from '@/components/workshop/CodeBlock';
import { Exercise } from '@/components/workshop/Exercise';
import { Hint } from '@/components/workshop/Hint';
import { Checkpoint } from '@/components/workshop/Checkpoint';
import { TestButton } from '@/components/workshop/TestButton';



We connect to Firebolt via an MCP client. In the workshop, we use mocked results for reliability.

Tutorial: [Firebolt Lab](https://www.devrelsquad.com/firebolt-lab)

## Prebuilt Queries

Try "revenue" and "top_products" in the demo. See `src/lib/agents/analytics.ts`.

## TODO: Customer Growth

<Exercise title="Add month-over-month customer growth query">
Implement `getCustomerGrowth`:

<CodeBlock language="sql" code={`SELECT\n  DATE_TRUNC('month', signup_date) AS month,\n  COUNT(*) AS new_customers,\n  CASE WHEN LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date)) = 0\n       THEN NULL\n       ELSE ROUND(\n         (COUNT(*) - LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date)))\n         / NULLIF(LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date)), 0) * 100, 2\n       ) END AS growth_pct\nFROM customers\nWHERE signup_date > '2024-01-01'\nGROUP BY month\nORDER BY month;`} />

<Hint title="Working answer (click to reveal)">
<CodeBlock language="tsx" code={`async getCustomerGrowth() {\n  const query = \`\n    SELECT\n      DATE_TRUNC('month', signup_date) as month,\n      COUNT(*) as new_customers,\n      CASE WHEN LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date)) = 0\n           THEN NULL\n           ELSE ROUND((COUNT(*) - LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date))) / NULLIF(LAG(COUNT(*)) OVER (ORDER BY DATE_TRUNC('month', signup_date)), 0) * 100, 2)\n      END as growth_pct\n    FROM customers\n    WHERE signup_date > '2024-01-01'\n    GROUP BY month\n    ORDER BY month\n  \`;\n  return this.mcpClient.execute(query);\n}`} />
</Hint>

Edge cases:
- First month has no prior data â†’ growth is NULL.
- Months with zero customers should not divide by zero.

</Exercise>

## TODO: Optimize Queries

<Exercise title="Optimize slow revenue query">
Consider:
- Date partitioning on `sales.date`
- Aggregating tables for frequently accessed metrics
- Caching layer in the app for repeated queries

Update `optimizeQuery` to return your plan or revised SQL.

<Hint title="Sample optimization (click to reveal)">
Use a materialized aggregate table `sales_daily(amount_sum, date)` and query that table. Add partitioning by date and indexes on `date`.
</Hint>

</Exercise>

<Checkpoint items={["Customer growth query returns month, new_customers, growth_pct","Optimization plan drafted in optimizeQuery"]} />

## Test

<TestButton label="Run sample analytics" message="Use the Analytics demo to run revenue/top_products; growth is a code task." />


