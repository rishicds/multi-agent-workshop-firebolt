---
title: "Orchestrator"
description: "Parse intents and route tasks"
duration: "45 minutes"
difficulty: "intermediate"
objectives:
  - "Understand intent parsing"
  - "Implement multi-step orchestration"
---

import { CodeBlock } from '@/components/workshop/CodeBlock';
import { Exercise } from '@/components/workshop/Exercise';
import { Hint } from '@/components/workshop/Hint';
import { Checkpoint } from '@/components/workshop/Checkpoint';
import { TestButton } from '@/components/workshop/TestButton';



We use Gemini to classify user intent and route to agents.

## Walkthrough

Open `src/lib/agents/orchestrator.ts` and review `parseIntent` and `routeTask`.

## TODO: Multi-step Queries

<Exercise title="Implement multi-step orchestration">
Implement `handleMultiStepQuery` to support prompts like:

> "Show revenue AND send report to alice@example.com"

- Split the input by connectors like "and", then call the correct agent in order.
- Use `AnalyticsAgent` to fetch data, `ReportAgent` to generate and email.

<Hint title="Working answer (click to reveal)">
<CodeBlock language="tsx" code={`async handleMultiStepQuery(userQuery: string) {\n  const steps: any[] = [];\n  const lower = userQuery.toLowerCase();\n  const hasRevenue = /revenue/.test(lower);\n  const recipientMatch = lower.match(/[\w.-]+@[\w.-]+\.[a-z]{2,}/);\n  const recipient = recipientMatch?.[0];\n\n  if (hasRevenue) {\n    const analytics = new (await import('./analytics')).AnalyticsAgent();\n    const result = await analytics.executeQuery('revenue');\n    steps.push({ step: 'analytics', output: result });\n    const reportAgent = new (await import('./report')).ReportAgent(process.env.GEMINI_API_KEY!);\n    const report = await reportAgent.generateReport(result, 'summary');\n    steps.push({ step: 'report', output: report });\n    if (recipient) {\n      const sent = await reportAgent.sendEmail(recipient, 'Revenue Summary', report);\n      steps.push({ step: 'email', output: sent });\n    }\n  }\n  return steps;\n}`} />
</Hint>

</Exercise>

<Checkpoint items={["handleMultiStepQuery returns an ordered steps array","Report is generated after analytics query","Email preview prints when recipient present"]} />

## Test

<TestButton label="Simulate Multi-step" message="Use the Live Demo with a multi-step prompt to verify." />


